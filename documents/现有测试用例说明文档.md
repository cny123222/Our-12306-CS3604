# 现有测试用例说明文档

## 文档说明

本文档梳理了代码仓库中所有测试用例文件及其作用，帮助开发团队了解测试覆盖范围和测试结构。

**最后更新时间**: 2025-01-14

---

## 目录

1. [后端单元测试](#后端单元测试)
2. [后端集成测试](#后端集成测试)
3. [前端组件测试](#前端组件测试)
4. [前端页面测试](#前端页面测试)
5. [前端跨页流程测试](#前端跨页流程测试)
6. [前端集成测试](#前端集成测试)
7. [端到端集成测试](#端到端集成测试)
8. [后端测试脚本](#后端测试脚本)
9. [系统验证脚本](#系统验证脚本)
10. [测试辅助文件](#测试辅助文件)

---

## 后端单元测试

### 位置: `backend/test/`

后端单元测试使用 Jest 框架，主要测试路由和服务层的功能。

### 路由测试 (`backend/test/routes/`)

#### 1. `auth.test.js` success 已检测覆盖度
- **作用**: 测试认证相关路由
- **测试内容**:
  - POST `/api/auth/login` - 用户登录功能
  - 用户名/密码验证
  - 邮箱/手机号登录
  - 登录失败处理
  - Session 管理
- **测试用例数**: 约 10+ 个

#### 2. `register.test.js`  success  已检测覆盖度
- **作用**: 测试用户注册路由
- **测试内容**:
  - POST `/api/auth/register` - 用户注册
  - 用户名唯一性验证
  - 密码验证
  - 手机号验证
  - 注册成功流程
- **测试用例数**: 约 41 个

#### 3. `trains.test.js`  失败  -> 已成功
- 最初：13 failed, 14 passed, 27 total
- **作用**: 测试车次查询相关路由
- **测试内容**:
  - POST `/api/trains/search` - 车次搜索
  - GET `/api/trains/:trainNo` - 获取车次详情
  - POST `/api/trains/available-seats` - 计算余票
  - GET `/api/trains/filter-options` - 获取筛选选项
- **测试用例数**: 约 15+ 个

#### 4. `stations.test.js`  success 未检测覆盖度
- **作用**: 测试站点相关路由
- **测试内容**:
  - GET `/api/stations` - 获取所有站点
  - POST `/api/stations/validate` - 验证站点
  - 站点搜索功能
- **测试用例数**: 约 5+ 个

#### 5. `orders.test.js`    success 未检测覆盖度
- **作用**: 测试订单相关路由
- **测试内容**:
  - GET `/api/orders/new` - 获取订单填写页信息
  - GET `/api/orders/available-seat-types` - 获取有票席别列表
  - POST `/api/orders/submit` - 提交订单
  - GET `/api/orders/:orderId/confirmation` - 获取订单核对信息
  - POST `/api/orders/:orderId/confirm` - 确认订单
- **测试用例数**: 约 20+ 个

#### 6. `passengers.test.js`    success 未检测覆盖度
- **作用**: 测试乘客管理相关路由
- **测试内容**:
  - GET `/api/passengers` - 获取用户乘客列表
  - POST `/api/passengers/search` - 搜索乘客
  - POST `/api/passengers` - 添加乘客
  - PUT `/api/passengers/:passengerId` - 更新乘客信息
  - DELETE `/api/passengers/:passengerId` - 删除乘客
- **测试用例数**: 约 15+ 个

#### 7. `userInfo.test.js`    success 未检测覆盖度
- **作用**: 测试用户信息相关路由
- **测试内容**:
  - GET `/api/user/info` - 获取用户信息
  - PUT `/api/user/info` - 更新用户信息
  - 手机号更新验证
- **测试用例数**: 约 8+ 个

### 服务层测试 (`backend/test/services/`)

#### 1. `authService.test.js`   检查skipped的原因
- Tests: 10 skipped, 10 passed, 20 total
- **作用**: 测试认证服务层逻辑
- **测试内容**:
  - `validateCredentials()` - 验证用户凭据
  - 用户名/邮箱/手机号登录支持
  - 密码加密验证
  - Session 创建和管理
- **测试用例数**: 约 10+ 个

#### 2. `registrationDbService.test.js`  success 未检测覆盖度
- **作用**: 测试注册数据库服务
- **测试内容**:
  - 用户名唯一性检查
  - 用户注册数据插入
  - 验证码生成和验证
- **测试用例数**: 19 个

#### 3. `orderService.test.js`  success 已修复 覆盖全部需求
- 25 failed, 1 passed, 26 total
- **作用**: 测试订单服务层逻辑
- **测试内容**:
  - `getDefaultSeatType()` - 获取默认席别（G字头默认二等座）
  - `getAvailableSeatTypes()` - 获取可用席别列表
  - `calculateTotalPrice()` - 计算订单总价
  - `submitOrder()` - 提交订单
  - `confirmOrder()` - 确认订单
  - 座位分配逻辑
- **测试用例数**: 18 个

#### 4. `passengerService.test.js`  success 已修复 全部通过 未检测覆盖度
- Tests: 22 failed, 16 passed, 38 total
- Tests: 1 failed, 37 passed, 38 total
- **作用**: 测试乘客服务层逻辑
- **测试内容**:
  - 获取用户乘客列表
  - 添加乘客
  - 更新乘客信息
  - 删除乘客
  - 乘客搜索功能
- **测试用例数**: 38 个

#### 5. `passengerManagementDbService.test.js` success 未测试覆盖度
- **作用**: 测试乘客管理数据库服务
- **测试内容**:
  - 乘客数据 CRUD 操作
  - 乘客与用户关联验证
  - 乘客信息查询
- **测试用例数**: 8 个

#### 6. `userInfoDbService.test.js`  success 已修复 全覆盖需求
- Tests:  11 failed, 9 passed, 20 total
- **作用**: 测试用户信息数据库服务
- **测试内容**:
  - 获取用户信息
  - 更新用户信息
  - 手机号更新验证
  - 用户信息查询
- **测试用例数**: 23 个

#### 7. `trainDataIntegrity.test.js`    success 已修复
- Tests: 7 failed, 6 passed, 13 total
- **作用**: 测试车次数据完整性
- **测试内容**:
  - 车次数据一致性验证
  - 停靠站数据完整性
  - 票价数据完整性
  - 座位配置数据完整性
- **测试用例数**: 13 个

### 其他测试文件（以下三个文件还未测试）

#### 1. `test-seat-formatter.js`
- **作用**: 测试座位格式化工具函数
- **测试内容**: 座位号格式化逻辑

#### 2. `init-test-db.js`
- **作用**: 初始化测试数据库
- **功能**:
  - 创建测试数据库表结构
  - 插入测试数据（用户、车次、站点、订单等）
  - 为测试提供标准化的测试环境

#### 3. `setup.js`
- **作用**: Jest 测试环境配置
- **功能**:
  - 设置测试环境变量
  - 初始化测试数据库
  - 测试前后清理工作

---

## 后端集成测试

### 位置: `backend/test/integration/`

#### 1. `login.integration.test.js`  success 未测覆盖度
- Tests: 14 passed, 14 total
- **作用**: 登录流程集成测试
- **测试内容**:
  - 完整的登录流程（从请求到响应）
  - 数据库交互验证
  - Session 创建验证
  - Token 生成验证
- **测试用例数**: 14 个

---

## 前端组件测试

### 位置: `frontend/test/components/`

前端组件测试使用 Vitest + React Testing Library 框架。

#### 1. `LoginForm.test.tsx`  success 未测试覆盖度
- **作用**: 测试登录表单组件
- **测试内容**:
  - 表单渲染
  - 用户输入处理
  - 表单提交
  - 错误提示显示
  - 加载状态显示
- **测试用例数**: 17 个

#### 2. `RegisterForm.test.tsx`  success 未测试覆盖度
- **作用**: 测试注册表单组件
- **测试内容**:
  - 表单字段渲染
  - 字段验证（用户名、密码、姓名、证件号等）
  - 实时验证反馈
  - 表单提交
- **测试用例数**: 41 个

#### 3. `ValidationInput.test.tsx`  success 未测试覆盖度
- **作用**: 测试验证输入框组件
- **测试内容**:
  - 输入验证逻辑
  - 错误提示显示
  - 成功状态显示（绿色勾勾）
- **测试用例数**: 21 个

#### 4. `SelectDropdown.test.tsx`  success 已修复
- Tests  1 failed | 4 passed (16) 
- **作用**: 测试下拉选择组件
- **测试内容**:
  - 下拉菜单显示/隐藏
  - 选项选择
  - 搜索功能
- **测试用例数**: 16 个

#### 5. `TopNavigation.test.tsx`  检查为什么skipped
- Tests  2 passed | 4 skipped (6)
- **作用**: 测试顶部导航栏组件
- **测试内容**:
  - Logo 显示
  - 导航链接显示
  - 登录/注册按钮显示
  - 个人中心入口（已登录状态）
- **测试用例数**: 6 个

#### 6. `BottomNavigation.test.tsx` 测试失败
- Tests  1 failed (8)
- **作用**: 测试底部导航栏组件
- **测试内容**:
  - 导航项显示
  - 导航跳转功能
  - 当前页面高亮
- **测试用例数**: 8 个

#### 7. `PassengerInfoSection.test.tsx`  测试失败
- Tests  1 failed (21)
- **作用**: 测试乘客信息选择组件
- **测试内容**:
  - 乘客列表显示
  - 乘客选择
  - 席别选择
- **测试用例数**: 21 个

#### 8. `OrderConfirmationModal.test.tsx` 测试失败
- Tests  1 failed (4)
- **作用**: 测试订单确认弹窗组件
- **测试内容**:
  - 订单信息显示
  - 确认/取消按钮
  - 订单详情展示
- **测试用例数**: 4 个

#### 9. `OrderConfirmationModal.test.FIXED.tsx`
- **作用**: 修复版本的订单确认弹窗测试
- **说明**: 可能是之前版本的修复版本

#### 10. `SuccessModal.test.tsx`
- **作用**: 测试成功提示弹窗组件
- **测试内容**:
  - 成功消息显示
  - 自动关闭功能
- **测试用例数**: 约 3+ 个

#### 11. `SmsVerificationModal.test.tsx`
- **作用**: 测试短信验证弹窗组件
- **测试内容**:
  - 验证码输入
  - 提交验证
  - 错误提示
- **测试用例数**: 约 5+ 个

#### 12. `RegistrationVerificationModal.test.tsx`
- **作用**: 测试注册验证弹窗组件
- **测试内容**:
  - 验证码输入
  - 注册验证流程
- **测试用例数**: 约 5+ 个

---

## 前端页面测试

### 位置: `frontend/test/pages/`

#### 1. `HomePage.ui-elements.test.tsx`
- **作用**: 测试首页 UI 元素渲染
- **测试内容**:
  - 导航栏显示
  - 查询表单显示
  - 底部导航显示
  - 宣传栏显示
- **测试用例数**: 约 10+ 个

#### 2. `HomePage.functional.test.tsx`
- **作用**: 测试首页功能业务逻辑
- **测试内容**:
  - 出发地验证（为空提示）
  - 到达地验证（为空提示）
  - 查询表单提交
  - 高铁/动车筛选
  - 日期选择
- **测试用例数**: 约 15+ 个

#### 3. `LoginPage.test.tsx`
- **作用**: 测试登录页面
- **测试内容**:
  - 页面渲染
  - 登录表单交互
  - 导航到注册页
  - 登录成功跳转
- **测试用例数**: 约 8+ 个

#### 4. `TrainListPage.ui-elements.test.tsx`
- **作用**: 测试车次列表页 UI 元素
- **测试内容**:
  - 车次列表显示
  - 筛选面板显示
  - 导航栏显示
- **测试用例数**: 约 8+ 个

#### 5. `TrainListPage.functional.test.tsx`
- **作用**: 测试车次列表页功能
- **测试内容**:
  - 车次搜索
  - 筛选功能（车次类型、席别）
  - 预订按钮点击
  - 返回首页
- **测试用例数**: 约 12+ 个

#### 6. `OrderPage.ui-elements.test.tsx`
- **作用**: 测试订单填写页 UI 元素
- **测试内容**:
  - 车次信息显示
  - 乘客选择区域
  - 席别选择
  - 提交按钮
- **测试用例数**: 约 8+ 个

#### 7. `OrderPage.functional.test.tsx`
- **作用**: 测试订单填写页功能
- **测试内容**:
  - 乘客选择
  - 席别选择
  - 订单提交
  - 订单确认弹窗
- **测试用例数**: 约 12+ 个

#### 8. `PersonalInfoPage.test.tsx`
- **作用**: 测试个人信息页面
- **测试内容**:
  - 用户信息显示
  - 信息编辑功能
  - 乘客管理
  - 订单历史
- **测试用例数**: 约 15+ 个

---

## 前端跨页流程测试

### 位置: `frontend/test/cross-page/`

跨页流程测试用于验证用户在不同页面间跳转和完整业务流程。

#### 登录/注册流程测试

##### 1. `LoginToRegister.cross.spec.tsx`
- **作用**: 测试从登录页到注册页的导航流程
- **测试内容**:
  - 从登录页点击"注册12306账号"按钮跳转
  - 从顶部导航栏"注册"链接跳转
  - 注册页 UI 元素验证
  - 用户协议勾选框验证
- **测试用例数**: 5 个

##### 2. `RegisterFormValidation.cross.spec.tsx`
- **作用**: 测试注册表单验证流程
- **测试内容**:
  - 用户名验证（长度、格式、唯一性）
  - 密码验证（长度、复杂度）
  - 确认密码验证
  - 姓名验证
  - 证件号码验证
  - 手机号码验证
  - 邮箱验证（选填）
  - 用户协议勾选验证
- **测试用例数**: 8 个

##### 3. `RegisterToVerification.cross.spec.tsx`
- **作用**: 测试注册到验证页的流程
- **测试内容**:
  - 完整信息填写后允许提交
  - 信息不完整时阻止提交
  - 字段验证失败时阻止提交
  - 密码强度指示器交互
  - 证件类型选择交互
  - 优惠类型选择交互
- **测试用例数**: 7 个

##### 4. `LoginFlow.cross.spec.tsx`
- **作用**: 测试完整登录流程
- **测试内容**:
  - 登录页 → 短信验证 → 首页
  - 登录成功后保存 token
  - 首页显示登录状态
  - 登录失败处理
  - 短信验证失败处理
- **测试用例数**: 5 个

##### 5. `RegisterToLogin.e2e.spec.tsx`
- **作用**: 测试注册到登录的完整端到端流程
- **测试内容**:
  - 注册页 → 注册验证 → 登录页 → 短信验证 → 首页
  - 注册页直接导航到登录页
  - 验证整个流程中用户状态变化
- **测试用例数**: 2 个

#### 首页/车次列表流程测试

##### 6. `HomePage.cross.spec.tsx`
- **作用**: 测试首页跨页导航流程
- **测试内容**:
  - 首页 → 登录页（通过导航栏）
  - 首页 → 注册页（通过导航栏）
  - 首页 Logo 点击
  - 未登录用户访问个人中心
  - 查询表单验证
  - 填写完整信息后跳转到车次列表页
  - 勾选"高铁/动车"后跳转
- **测试用例数**: 14 个

##### 7. `TrainList.cross.spec.tsx`
- **作用**: 测试车次列表页跨页流程
- **测试内容**:
  - 车次列表页 → 登录页
  - 车次列表页 → 注册页
  - 车次列表页 → 首页（点击 Logo）
  - 首页 → 车次列表页（接收查询参数）
  - 车次列表页初始状态验证
  - 筛选面板显示
  - 参数传递验证
- **测试用例数**: 12 个

##### 8. `HomeToTrainList.e2e.spec.tsx`
- **作用**: 测试首页到车次列表页的端到端流程
- **测试内容**:
  - 完整流程：首页填写查询表单 → 车次列表页
  - 勾选高铁/动车后查询
  - 表单验证（出发地/到达地为空）
  - 从车次列表页返回首页重新查询
  - 页面跳转过程中 Logo 和底部导航始终存在
- **测试用例数**: 8 个

#### 订单填写页流程测试

##### 9. `OrderPage.cross.spec.tsx`
- **作用**: 测试订单填写页跨页导航
- **测试内容**:
  - 订单填写页 → 登录页
  - 订单填写页 → 注册页
  - 订单填写页 → 首页（点击 Logo）
  - 订单填写页 → 车次列表页（点击"上一步"）
  - 未登录访问订单页 → 跳转到登录页
  - 订单填写页接收并显示车次参数
  - 缺少必要参数时显示错误信息
- **测试用例数**: 11 个

##### 10. `OrderSubmission.cross.spec.tsx`
- **作用**: 测试订单提交流程
- **测试内容**:
  - 成功场景：选择乘客 → 提交订单 → 显示信息核对弹窗
  - 成功场景：信息核对弹窗 → 返回修改
  - 异常场景：未选择乘客提示
  - 异常场景：车票售罄处理
  - 异常场景：网络异常处理
  - 异常场景：提交订单时未登录处理
  - 席别选择：选择乘客后自动填充默认席别
- **测试用例数**: 7 个

##### 11. `TrainListToOrder.e2e.spec.tsx`
- **作用**: 测试车次列表到订单填写页的端到端流程
- **测试内容**:
  - 完整流程：首页 → 车次列表 → 订单填写页
  - 订单填写页 → 车次列表页（保留查询参数）
  - 订单填写页 → 首页（点击 Logo）
  - 参数传递验证
  - 未登录流程处理
  - 完整流程：进入订单页 → 选择乘客 → 提交订单
- **测试用例数**: 8 个

#### 完整业务流程测试

##### 12. `CompleteBookingFlow.e2e.spec.tsx`
- **作用**: 测试完整订票流程端到端
- **测试内容**:
  - 完整流程：首页(已登录) → 车次列表 → 订单填写 → 提交成功
  - 未登录访问订单页重定向到登录页
  - 车次列表返回首页
  - 订单填写页返回车次列表
  - 整个流程中保持登录状态
  - 验证 localStorage 中 token 的使用
- **测试用例数**: 6 个

#### 个人信息页流程测试

##### 13. `PersonalInfoNavigation.cross.spec.tsx`
- **作用**: 测试个人信息页导航流程
- **测试内容**:
  - 个人信息页导航入口
  - 页面跳转功能
  - 登录状态验证
- **测试用例数**: 7 个

##### 14. `PhoneVerificationFlow.cross.spec.tsx`
- **作用**: 测试手机号验证流程
- **测试内容**:
  - 手机号更新流程
  - 短信验证码发送
  - 验证码验证
  - 更新成功处理
- **测试用例数**: 8 个

##### 15. `PassengerManagementFlow.cross.spec.tsx`
- **作用**: 测试乘客管理流程
- **测试内容**:
  - 添加乘客
  - 编辑乘客信息
  - 删除乘客
  - 乘客列表显示
- **测试用例数**: 10 个

##### 16. `OrderHistoryFlow.cross.spec.tsx`
- **作用**: 测试订单历史查看流程
- **测试内容**:
  - 订单列表显示
  - 订单详情查看
  - 订单状态筛选
  - 订单搜索功能
- **测试用例数**: 9 个

##### 17. `PersonalInfoEditing.cross.spec.tsx`
- **作用**: 测试个人信息编辑流程
- **测试内容**:
  - 用户信息编辑
  - 信息验证
  - 保存功能
  - 错误处理
- **测试用例数**: 12 个

#### 订单确认相关测试

##### 18. `OrderConfirmation.cross.spec.tsx`
- **作用**: 测试订单确认流程
- **测试内容**: 订单确认弹窗交互

##### 19. `OrderConfirmSuccess.cross.spec.tsx`
- **作用**: 测试订单确认成功流程
- **测试内容**: 订单确认后的成功提示

##### 20. `OrderConfirmWithSeatAllocation.cross.spec.tsx`
- **作用**: 测试带座位分配的订单确认流程
- **测试内容**: 座位分配逻辑验证

##### 21. `OrderPageSeatConsistency.cross.spec.tsx`
- **作用**: 测试订单页座位一致性
- **测试内容**: 座位状态一致性验证

##### 22. `OrderPageCrossInterval.integration.spec.tsx`
- **作用**: 测试订单页跨区间集成测试
- **测试内容**: 跨区间票价计算验证

##### 23. `LoginStateManagement.integration.spec.tsx`
- **作用**: 测试登录状态管理集成测试
- **测试内容**: 登录状态在页面间的保持

**跨页流程测试总计**: 约 139 个测试用例

---

## 前端集成测试

### 位置: `frontend/test/integration/`

#### 1. `LoginFlow.integration.test.tsx`
- **作用**: 登录流程集成测试
- **测试内容**:
  - 完整的登录流程
  - API 调用验证
  - 状态管理验证
- **测试用例数**: 约 5+ 个

#### 2. `RegistrationFlow.integration.test.tsx`
- **作用**: 注册流程集成测试
- **测试内容**:
  - 完整的注册流程
  - API 调用验证
  - 验证码验证流程
- **测试用例数**: 约 5+ 个

---

## 端到端集成测试

### 位置: `integration-tests/`

端到端测试直接调用后端 API，验证前后端完整交互。

#### 1. `e2e-complete-flow-test.js`
- **作用**: 端到端完整业务流程测试
- **测试内容**:
  - 从首页查询到订单提交的完整用户旅程
  - 站点查询
  - 车次搜索
  - 车次详情获取
  - 余票查询
  - 订单提交
  - 订单确认
- **测试场景**: 约 10+ 个

#### 2. `integration-test-home-trains.js`
- **作用**: 首页和车次列表页集成测试
- **测试内容**:
  - 首页查询功能
  - 车次列表获取
  - 车次筛选
  - 前后端数据流转验证
- **测试场景**: 约 15+ 个

#### 3. `integration-test-order.js`
- **作用**: 订单相关功能集成测试
- **测试内容**:
  - 订单创建流程
  - 订单查询
  - 订单确认
  - 订单状态管理
- **测试场景**: 约 10+ 个

#### 4. `integration-test-personal-info.js`
- **作用**: 个人信息相关功能集成测试
- **测试内容**:
  - 用户信息获取
  - 用户信息更新
  - 乘客管理
  - 订单历史查询
- **测试场景**: 约 12+ 个

#### 5. `verify-system.js`
- **作用**: 系统验证脚本
- **测试内容**:
  - 后端服务启动验证
  - 前端服务启动验证
  - CORS 配置验证
  - 数据库连接验证
  - 注册相关 API 端点验证
  - 站点相关 API 端点验证
  - 车次相关 API 端点验证
  - 订单相关 API 端点验证
  - 乘客相关 API 端点验证
  - 完整注册流程验证
- **功能**: 验证整个系统的健康状态和连通性

---

## 后端测试脚本

### 位置: `backend/scripts/`

这些脚本用于测试特定功能或调试问题，不是标准的单元测试。

#### 1. `test-concurrent-booking.js`
- **作用**: 高并发购票测试
- **测试内容**:
  - 模拟多用户同时购票场景
  - 验证余票数据一致性
  - 验证不会出现超卖（余票为负）
  - 验证余票计算的并发安全性

#### 2. `test-seat-atomicity-fix.js`
- **作用**: 测试座位预定原子性修复
- **测试内容**:
  - 确保商务座只剩1张票时，尝试为2个乘客购买2张商务座票
  - 验证订单确认失败
  - 验证余票数仍然是1张（没有被错误地标记为已预定）

#### 3. `test-seat-atomicity-unit.js`
- **作用**: 座位预定原子性单元测试
- **测试内容**:
  - 直接测试数据库操作，不依赖 API 服务器
  - 验证座位预定的原子性
  - 验证并发场景下的数据一致性

#### 4. `test-fare-calculation.js`
- **作用**: 测试票价计算功能
- **测试内容**:
  - 票价计算逻辑
  - 跨区间票价累加
  - 不同席别票价计算

#### 5. `test-seat-availability.js`
- **作用**: 测试座位可用性查询
- **测试内容**:
  - 余票查询逻辑
  - 座位状态查询
  - 跨区间座位可用性

#### 6. `test-seat-display-logic.js`
- **作用**: 测试座位显示逻辑
- **测试内容**:
  - 座位信息格式化
  - 座位状态显示

#### 7. `test-order-query-fix.js`
- **作用**: 测试订单查询修复
- **测试内容**:
  - 订单查询功能
  - 订单数据正确性

#### 8. `test-passenger-name-fix.js`
- **作用**: 测试乘客姓名修复
- **测试内容**:
  - 乘客姓名显示
  - 乘客信息查询

#### 9. `test-phone-update-api.js`
- **作用**: 测试手机号更新 API
- **测试内容**:
  - 手机号更新功能
  - 手机号验证

#### 10. `test-phone-update-test777.js`
- **作用**: 测试特定用户（test777）的手机号更新
- **测试内容**: 特定场景的手机号更新测试

#### 11. `test-token-decode.js`
- **作用**: 测试 Token 解码功能
- **测试内容**:
  - JWT Token 解析
  - Token 验证

#### 12. `test-search-orders.js`
- **作用**: 测试订单搜索功能
- **测试内容**:
  - 订单搜索
  - 订单列表查询
  - 订单详情查询

#### 13. `create-test-order.js`
- **作用**: 创建测试订单
- **功能**: 用于测试环境创建测试数据

#### 14. `delete-test-orders.js`
- **作用**: 删除测试订单
- **功能**: 清理测试数据

#### 15. `clean-pending-orders.js`
- **作用**: 清理待处理订单
- **功能**: 清理过期或无效的待处理订单

#### 16. `check-user-order-match.js`
- **作用**: 检查用户订单匹配
- **功能**: 验证用户和订单的关联关系

#### 17. `check-order-passenger-details.js`
- **作用**: 检查订单乘客详情
- **功能**: 验证订单中的乘客信息

#### 18. `check-liujiamin-orders.js`
- **作用**: 检查特定用户（liujiamin）的订单
- **功能**: 调试特定用户的订单问题

#### 19. `check-seat-count-by-train-seat-car.js`
- **作用**: 按车次、席别、车厢检查座位数量
- **功能**: 验证座位数据完整性

#### 20. `check-passenger-ownership.js`
- **作用**: 检查乘客所有权
- **功能**: 验证乘客与用户的关联关系

#### 21. `verify-train-data.js`
- **作用**: 验证车次数据
- **功能**: 验证车次数据的完整性和正确性

---

## 后端根目录测试文件

### 位置: `backend/`

#### 1. `test-seat-atomicity-fix.js`
- **作用**: 测试座位预定原子性修复（与 scripts 目录下的版本可能不同）
- **说明**: 可能是独立运行的测试脚本

#### 2. `test-seat-atomicity-unit.js`
- **作用**: 座位预定原子性单元测试（与 scripts 目录下的版本可能不同）

#### 3. `test-search-orders.js`
- **作用**: 测试订单搜索功能（与 scripts 目录下的版本可能不同）

---

## 测试辅助文件

### 前端测试配置

#### 1. `frontend/vitest.config.ts`
- **作用**: Vitest 测试框架配置文件
- **功能**: 配置测试环境、覆盖率等

#### 2. `frontend/test_debug.tsx`
- **作用**: 前端测试调试文件
- **功能**: 用于调试测试问题

### 测试运行脚本

#### 1. `run-all-tests.sh`
- **作用**: 运行所有测试的脚本
- **功能**: 统一运行前后端所有测试

#### 2. `run-integration-tests.sh`
- **作用**: 运行集成测试的脚本
- **功能**: 运行端到端集成测试

---

## 测试统计汇总

### 测试文件总数统计

| 测试类型 | 文件数量 | 测试用例数（估算） |
|---------|---------|------------------|
| 后端路由测试 | 7 | 80+ |
| 后端服务测试 | 7 | 85+ |
| 后端集成测试 | 1 | 5+ |
| 前端组件测试 | 12 | 90+ |
| 前端页面测试 | 8 | 90+ |
| 前端跨页流程测试 | 23 | 139 |
| 前端集成测试 | 2 | 10+ |
| 端到端集成测试 | 5 | 50+ |
| 后端测试脚本 | 21 | 不定 |
| **总计** | **86+** | **549+** |

### 测试覆盖范围

#### 功能模块覆盖

- ✅ **用户认证**: 登录、注册、Session 管理
- ✅ **车次查询**: 搜索、筛选、详情查看
- ✅ **订单管理**: 创建、提交、确认、查询
- ✅ **乘客管理**: 添加、编辑、删除、查询
- ✅ **用户信息**: 信息查看、编辑、手机号更新
- ✅ **页面导航**: 跨页跳转、参数传递
- ✅ **业务流程**: 完整订票流程、注册登录流程

#### 测试层级覆盖

- ✅ **单元测试**: 组件、服务、路由
- ✅ **集成测试**: 前后端交互、API 调用
- ✅ **端到端测试**: 完整用户流程
- ✅ **跨页测试**: 页面间跳转和状态管理

---

## 运行测试

### 后端测试

```bash
# 进入后端目录
cd backend

# 运行所有测试
npm test

# 运行特定测试文件
npm test -- test/routes/auth.test.js

# 运行测试并生成覆盖率报告
npm test -- --coverage
```

### 前端测试

```bash
# 进入前端目录
cd frontend

# 运行所有测试
npm test

# 运行特定测试文件
npm test -- test/components/LoginForm.test.tsx

# 运行跨页流程测试
npm test -- test/cross-page

# 运行测试并生成覆盖率报告
npm test -- --coverage
```

### 集成测试

```bash
# 运行系统验证脚本
node integration-tests/verify-system.js

# 运行端到端测试
node integration-tests/e2e-complete-flow-test.js

# 运行所有集成测试
./run-integration-tests.sh
```

### 运行所有测试

```bash
# 在项目根目录
./run-all-tests.sh
```

---

## 测试维护建议

1. **定期运行测试**: 在代码提交前运行相关测试
2. **保持测试更新**: 当功能变更时，同步更新测试用例
3. **测试覆盖率**: 保持测试覆盖率在合理水平（建议 > 80%）
4. **测试数据管理**: 使用独立的测试数据库，避免影响生产数据
5. **测试文档更新**: 当添加新测试时，及时更新本文档

---

## 注意事项

1. **测试环境**: 确保测试环境与生产环境隔离
2. **测试数据**: 使用测试专用的数据库和测试数据
3. **异步测试**: 注意处理异步操作的测试
4. **Mock 数据**: 合理使用 Mock 避免依赖外部服务
5. **测试隔离**: 每个测试应该独立运行，不依赖其他测试的状态

---

**文档维护者**: 测试团队  
**最后更新**: 2025-01-14

