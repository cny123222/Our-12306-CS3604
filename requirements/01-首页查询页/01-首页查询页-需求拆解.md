# 01-首页/查询页 需求拆解

概述：基于《01-首页查询页.md》梳理功能点、业务规则、边界场景与数据依赖，为后续设计、开发与测试提供统一依据。当前阶段仅覆盖“车票-单程”。

1) 功能清单
- 顶部导航栏
  - 未登录：显示“登录”“注册”“个人中心”入口；已登录：仅显示“个人中心”。
- 车票查询表单
  - 出发地、到达地输入框（站点选择/模糊匹配/下拉推荐）
  - 出发日期选择器（只可选择已放票日期；不可选择过期或未开票日期）
  - 查询按钮
  - 出发地/到达地交换按钮
  - 出发日期默认填入当前日期（用户未选择时）
- 常用功能快捷入口
  - 个人中心入口、车票查询入口
- 页面跳转
  - 查询成功：在100毫秒内跳转至车次列表页，展示与选择一致的车次信息（出发地、到达地、出发日期、是否高铁/动车）。
  - 查询失败：停留在当前页，保留用户已输入内容并提示“查询失败，请稍后重试”。
- 登录/注册/个人中心
  - 登录、注册入口在未登录状态下可用；成功跳转至对应页面；失败提示。
  - 个人中心入口：已登录跳转个人中心，未登录跳转登录页。

2) 业务规则与校验
- 必填校验
  - 出发地为空：点击“查询”提示“请选择出发地”。
  - 到达地为空：点击“查询”提示“请选择到达地”。
- 合法性校验（站点在12306支持列表中）
  - 出发地不合法：提示“无法匹配该出发地”，并在下拉中推荐相似站点；支持点击填充。
  - 到达地不合法：提示“无法匹配该到达地”，并在下拉中推荐相似站点；支持点击填充。
- 推荐与选择
  - 点击出发地/到达地输入框，均显示全部支持站点，可搜索过滤。
- 日期选择
  - 点击出发日期选择框，显示日历；仅可选择已放票日期；不可选择过期/未开票日期。
  - 未选择日期时，默认填入当前日期（本地时间）。
- 出发地/到达地交换
  - 点击“交换”按钮，互换两个输入框内容；若某一项为空，交换后保持另一项的值与空值对应。
- 性能要求
  - 成功查询的跳转应在100毫秒内完成；若超过阈值或后端未响应，按照失败流程提示与停留。

3) 数据依赖
- 站点列表（12306支持站点全集）
  - 字段建议：station_id、station_name_cn、station_name_py、alias_list、station_code。
  - 前端需支持中文/拼音/别名匹配；模糊推荐需基于相似度（如拼音编辑距离、前缀匹配）。
- 放票日历/可售日期集合
  - 根据12306放票规则提供已开放销售的日期集合。
- 车次列表查询接口
  - 入参：from_station、to_station、date、filters（student/high-speed/EMU等）；
  - 出参：车次基本信息与余票状态。
- 用户与会话
  - 登录态判定、用户信息查询，用于导航栏显示与个人中心跳转。

4) 边界与异常场景
- 输入内容
  - 中英文/拼音/大小写/空格处理；非法字符剔除与提示；最小输入长度与防抖（如≥2字符开始推荐）。
- 推荐与选择
  - 推荐结果为空时的文案与操作指引；重复选择、快速切换时的状态一致性。
- 日期
  - 跨时区与本地时间一致性；当天午夜切换的默认日期更新策略；选择非法日期的阻止与提示。
- 交换
  - 同站点交换（出发=到达）提示与可否阻止（建议允许，但查询时做一致性校验并提示无效路线）。
- 跳转与失败
  - 未响应或超时：保持输入并提示失败；允许用户重试；避免清空。
- 登录态
  - 未登录点击个人中心：跳转登录页并提示“请先登录12306账号！”（或在登录页提示）。

5) 交互与文案规范
- 错误提示原文统一：
  - “请选择出发地”“请选择到达地”“无法匹配该出发地”“无法匹配该到达地”“查询失败，请稍后重试”“登录失败，请稍后重试”“注册失败，请稍后重试”“前往个人中心失败，请稍后重试”“请先登录12306账号！”
- 组件状态
  - 查询按钮在必填项未满足时可禁用或点击后提示；
  - 日期组件禁用不可选日期；
  - 输入框获得焦点显示下拉；失焦保留选择；
  - 交换按钮在两个输入框均为空时仍可点击但不改变状态。

6) 性能与体验
- 路由跳转目标100毫秒内完成；如无法保证真实后端性能，建议增加过渡/预加载策略、骨架屏与容错提示，以遵循需求体验。
- 模糊搜索与推荐建议引入防抖（200ms）与本地缓存，减少多次请求。

7) 可观测性与埋点（建议）
- 埋点：输入框聚焦、推荐点击、查询点击、成功/失败、交换点击、日期选择。
- 错误日志：后端未响应、接口错误码、前端异常。

8) 安全与合规（建议）
- 输入清洗与XSS防护；
- 接口请求鉴权与速率限制（登录态相关操作）。

9) 非功能性要求（建议）
- 可用性：核心操作路径可用率≥99%；
- 兼容性：现代浏览器与移动端适配（如需）；
- 可维护性：组件化与单元测试覆盖关键验证逻辑。

附：需求来源
- requirements/01-首页查询页/01-首页查询页.md