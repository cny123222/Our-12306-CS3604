< 车票状态仅支持有票，无票，余票20张以内，不支持候补车票>
4. 车票查询与筛选
    
    4.1 车票查询页面布局
        4.1.1 整体页面布局：背景为白色，从上到下分为5个部分，从上到下依次为**页面顶部导航区域**，**车次搜索和查询区域**，**车次信息筛选区域**，**车次列表区域**和**底部导航区域**
        
        4.1.2 **页面顶部导航区域**
            4.1.2.1 与首页一致
            4.1.2.2 **Logo 区域**：页面左上角为Logo区域，左侧为中国铁路12306官方Logo，右侧上方为黑色“中国铁路12306”、下方为灰色“12306 CHINA RAILWAY”，点击可跳转到12306首页
            4.1.2.3 **欢迎信息**：Logo区域右侧为欢迎信息区域，显示黑色“欢迎登录12306”
        
        4.1.3 **车次搜索和查询区域**
            4.1.3.1 页面有一个搜索框，用户可以在搜索框中输入出发站、到达站、出发日期等信息
            4.1.3.2 页面有一个“查询”按钮，用户点击后会根据搜索框中的信息查询符合条件的车票

        4.1.4 **车次信息筛选区域**
            4.1.4.1 **车次信息筛选区域**展示在**车次搜索和查询区域**下方
            4.1.4.2 用户可以根据车次类型（“GC-高铁/城际”，“D-动车”），出发车站，到达车站，车次席别（“商务座”、“一等座”、“二等座”、“软卧”、“硬卧”）筛选符合条件的车次
            4.1.4.3 查询结果
                4.1.4.3.1 如果查询到符合条件的车次，车次列表会展示在**车次列表区域**中
                4.1.4.3.2 如果没有查询到符合条件的车次，**车次列表区域**为空白并出现提示“暂无符合条件的车次”

        4.1.5 **车次列表区域**
            4.1.5.1 车次列表展示在**车次搜索和查询区域**和**车次信息筛选区域**下方
            4.1.5.2 查询结果以“车次列表”形式展示，表格中的项包含车次、出发站/到达站、出发时间、到达时间、历时、一等座、二等座、软卧、硬卧等信息
            4.1.5.3 车次列表区域中每一项最右侧都有一个**预订**按钮，用户点击后会跳转到预订页面
            4.1.5.4 车次列表不包含换乘车次，仅展示符合查询条件和筛选条件的直达车次
        
        4.1.6 **底部导航区域**
            4.1.6.1 与首页保持一致
            4.1.6.2 **底部导航**：左侧为友情链接，右侧为四个官方平台的二维码，分别为“中国铁路官方微信”、“中国铁路官方微博”、“12306 公众号”、“铁路 12306”

        
    4.2 **车票查询页面**的进入
        
        4.2.1 首页通过点击“车票”快捷页面入口进入车票查询页面，采用默认的搜索栏内容
            Scenario：用户在**首页**中点击“车票”快捷页面入口成功加载**车票查询页面**
                Given：用户在**首页**通过点击“车票”快捷页面入口
                When：**车票查询页面**成功加载
                Then：**车票查询页面**的**车次列表区域**为空，且**车次搜索和查询区域**搜索框中均为默认状态。
                And：**车票查询页面**的**车次信息筛选区域**筛选栏中所有选项均为默认状态，即未被勾选。
        
        4.2.2 用户在**首页/查询页**中输入出发站、到达站、出发日期信息后，点击“查询”按钮，即可跳转到**车票查询页面**，**车票查询页面**的**车次列表区域**会展示符合条件的车次列表，并且自动将用户输入的出发站、到达站、出发日期填充到**车次搜索和查询区域**的搜索框中。
            Scenario：用户在**首页/查询页**中输入出发站、到达站、出发日期信息后，点击“查询”按钮且成功跳转到**车票查询页面**
                Given：用户在**首页/查询页**中输入出发站、到达站、出发日期信息
                When：用户点击“查询”按钮
                Then：跳转到**车票查询页面**，**车票查询页面**的**车次列表区域**会展示符合条件的车次列表，并且自动将用户输入的出发站、到达站、出发日期填充到搜索框中。

            Scenario：用户在**首页/查询页**中勾选了“GC-高铁/城际”选项
                Given：用户在**首页/查询页**中输入出发站、到达站、出发日期信息后，点击“查询”按钮，即可跳转到**车票查询页面**
                And：用户在**首页/查询页**中勾选了“GC-高铁/城际”选项
                When: 车票查询页面成功加载
                Then：**车票查询页面**会自动勾选**车次信息筛选区域**筛选框中的““GC-高铁/城际””和“D-动车“选项
                And：**车次列表区域**仅展示符合条件的高铁和动车车次

    4.3 用户查询车次信息
        4.3.1 用户未输入出发地或到达地或出发日期时，系统自动填充默认值
            Scenario：用户在**车次搜索和查询区域**未输入出发地
                Given：用户在**车票查询页面**
                When：用户未在**车次搜索和查询区域**的搜索栏中输入**出发地**或还未进行输入出发地操作
                Then：系统在“出发地”输入框填入默认状态，即“简拼/全拼/汉字”

            Scenario：用户未输入到达地
                Given：用户在**车票查询页面**
                When: 用户未在**车次搜索和查询区域**的搜索栏中输入**到达地**或还未进行输入到达地操作
                Then：系统在“到达地”输入框填入默认状态，即“简拼/全拼/汉字”
            
            Scenario：用户未输入出发日期
                Given：用户在**车票查询页面**
                When：用户未在**车次搜索和查询区域**的搜索栏中输入**出发日期**或还未进行输入出发日期操作
                Then：系统在“出发日期”输入框填入默认状态，即当前日期
        
        4.3.2 用户未输入出发地或到达地，点击“查询”按钮
            Scenario：用户未输入出发地和到达地，点击“查询”按钮
                Given：用户在**车票查询页面**，用户未在**车次搜索和查询区域**的搜索栏中输入**出发地**和**到达地**
                When：用户点击“查询”按钮
                Then：“出发地”输入框的轮廓变红，提示“请输入出发地”
                And：“到达地”输入框的轮廓变红，提示“请输入到达地”
            
            Scenario：用户输入到达地未输入出发地，点击“查询”按钮
                Given：用户在**车票查询页面**，用户在**车次搜索和查询区域**的搜索栏中输入了到达地但**未输入出发地**
                When：用户点击“查询”按钮
                Then：“出发地”输入框的轮廓变红，提示“请输入出发地”
            
            Scenario：用户输入出发地未输入到达地，点击“查询”按钮
                Given：用户在**车票查询页面**，用户在**车次搜索和查询区域**的搜索栏中输入了出发地但**未输入到达地**
                When：用户点击“查询”按钮
                Then：“到达地”输入框的轮廓变红，提示“请输入到达地”
        
        4.3.3 校验用户输入的出发地是否合法
            Scenario: 用户在输入的出发地不在**数据库**的城市列表中
                Given 用户在**车次搜索和查询区域**的**出发地输入框**中输入了一个不在**数据库**中的城市作为出发地
                When 用户在**车次搜索和查询区域**中点击**查询**
                Then 系统提示“无法匹配该出发地”
                And  系统在**出发地输入框**下拉条目中推荐具有一定相似度的**数据库**中的城市
                And  用户可以点击推荐城市，将其填充到出发地输入框中
        
        4.3.4 校验用户输入的到达地是否合法
            Scenario: 用户在输入的到达地不在**数据库**的城市列表中
                Given 用户在**车次搜索和查询区域**的**到达地输入框**中输入了一个不在**数据库**的城市作为到达地
                When 用户在**车次搜索和查询区域**中点击**查询**
                Then 系统提示“无法匹配该到达地”
                And  系统在**到达地输入框**下拉条目中推荐具有一定相似度的**数据库**中的城市
                And  用户可以点击推荐城市，将其填充到到达地输入框中
        
        4.3.5 合法出发地推荐
            Scenario: 用户未选择或已选择出发地
                Given 用户在**车票查询页面**
                When 用户在**车次搜索和查询区域**中点击**出发地输入框**
                Then 系统在**出发地输入框**下拉条目中显示**数据库**存储的所有站点
                And  用户可以点击推荐城市，将其填充到出发地输入框中

        4.3.6 合法到达地推荐
            Scenario: 用户未选择或已选择到达地
                Given 用户在**车票查询页面**
                When 用户在**车次搜索和查询区域**中点击**到达地输入框**
                Then 系统在**到达地输入框**下拉条目中显示**数据库**存储的所有站点
                And  用户可以点击推荐城市，将其填充到到达地输入框中

        4.3.7 合法出发日期推荐
            Scenario: 用户未选择或已选择出发日期
                Given 用户在**车票查询页面**
                When 用户在**车次搜索和查询区域**中点击**出发日期选择框**
                Then 系统在**出发日期选择框**下拉条目中显示日历，已放票的日期显示为黑色，不能选择已过期或未开票的日期显示为灰色
                And  用户如果点击**已放票**的日期，将其填充到出发日期选择框中
                And  用户如果点击**已过期或未放票**的日期，页面保持不变，无法将该日期填充到出发日期选择框内

        4.3.8 用户成功查询且系统响应
            Scenario: 用户输入了正确的出发地、到达地、出发日期且系统响应
                Given 用户在**车票查询页面**的**车次搜索和查询区域**中输入了正确的出发地、到达地、出发日期
                When 用户点击**查询**按钮
                Then 系统在100毫秒内在**车票查询页面**的**车次列表区域**显示符合用户选择的出发地、到达地、出发日期且是“GC-高铁/城际”，“D-动车”的所有车次信息列表

        4.3.9 用户成功查询但系统未响应
            Scenario: 用户输入了正确的出发地、到达地、出发日期但系统未响应
                Given 用户在**车票查询页面**的**车次搜索和查询区域**中输入了正确的出发地、到达地、出发日期
                When 用户点击**查询**按钮
                Then 系统未在100毫秒内显示符合用户选择的出发地、到达地、出发日期且是“GC-高铁/城际”，“D-动车”的所有车次信息列表，且提示“查询失败，请稍后重试”
    
    4.4 **车票数据库**
        4.4.1 **车票数据库**需要存储数据包括：
            - “车次”，“出发站”，所有“途经车站”，“到达站”，相邻两站之间“历时”
            - 车厢节号与对应车厢内席位种类，车厢内每个座位的座位序号，每个座位在线路相邻两站之间是否处于**空闲**或**已被预定**状态
            - 所有需要加入**车票数据库**的车次信息存储在“车次信息.json”文档中
            
        4.4.2 余票数的计算
            4.4.2.1 对于某一车次路线上相邻两站，直接从**数据库**中检索相邻站点之间相应席位的处于**空闲**状态的数量，得到结果后直接返回
            4.4.2.2 对于某一车次路线上不相邻的两站，如果有一个座位从出发站到到达站之间都处于**空闲**状态，则余票数加一；遍历整个列车所有特定席位的车厢，返回得到对应席位的余票数
            4.4.2.3 对于某一车次路线上不想临的两站，如果某一席位的的所有车厢的所有座位都在中途某两站之间的**已被预定**状态，则该车次席位余票数等于0
            4.4.2.4 **注意**：统计是否有余票时应该以座位为单位，只有一个座位从始至终都是**空闲**状态，余票数才加1。
        
        4.4.3 票价的计算：某两站之间某席位票价等于所有途经车站之间该席位票价之和
        
        4.4.4 数据库的更新与维护
            4.4.3.1 如果座位被用户**预定**成功，需要修改对应车次，对应车厢，对应座位号的相应站点之间**空闲**状态为**已被预定**状态
            4.4.3.2 数据库应支持新车次的加入与已有车次的删除
            4.4.3.4 数据库支持的“出发地“”到达地“分别为有数据库中车次途径或出发的车站/地区，数据库中有车次途径或到达的车站/地区


    4.5 用户筛选车次信息
        4.5.1 用户通过勾选复选框筛选车次
            Scenario: 用户在**车次信息筛选区域**选择某个车次类型
                Given：用户在**车票查询页面**，**车次列表区域**已显示
                When：用户在**车次类型**筛选栏中勾选某个车次类型复选框
                Then：**车次列表区域**的车次信息自动更新，仅显示符合该选项的车次，不检查相应车次是否有余票

            Scenario: 用户筛选某个出发站
                Given：用户在**车票查询页面**，**车次列表区域**已显示
                When：用户在**出发车站**筛选栏中勾选某个出发站复选框
                Then：**车次列表区域**的车次信息自动更新，仅显示从该出发站出发的车次

            Scenario: 用户筛选某个到达站
                Given：用户在**车票查询页面**，**车次列表区域**已显示
                When：用户在**到达车站**筛选栏中勾选某个到达站复选框
                Then：**车次列表区域**的车次信息自动更新，仅显示到达该到达站的车次

            Scenario: 用户筛选某个席别座位
                Given：用户在**车票查询页面**，**车次列表区域**已显示
                When：用户在某个筛选栏（如“车次席别”筛选栏）中勾选某个席别座位复选框
                Then：**车次列表区域**的车次信息自动更新，仅显示符合该选项的车次，不检查相应车次是否有余票
            
            Scenario：用户在同一筛选栏目勾选多个选项
                Given：用户在**车票查询页面**，**车次列表区域**已显示
                When：用户在某个筛选栏（如“车次类型”筛选栏）中勾选多于一个复选框
                Then：**车次列表区域**的车次信息自动更新，仅显示符合该筛选栏所勾选的选项的车次，不检查相应车次是否有余票（如用户勾选了“GC-高铁/城际”和“D-动车”，则仅显示“G”或“C”开头的车次或“D”字头的车次）

            Scenario: 用户在不同筛选栏目勾选多个选项
                Given：用户在**车票查询页面**，**车次列表区域**已显示
                When：用户在“车次类型”、“出发车站”、“到达车站”、“车次席别”筛选栏中勾选多于一个复选框（如勾选“GC-高铁/城际”、“D-动车”、“出发站A”、“到达站B”、“一等座”）
                Then：**车次列表区域**的车次信息自动更新，仅显示符合所勾选的“车次类型”、“出发车站”、“到达车站”、“车次席别”的车次，不检查相应车次是否有余票（如用户勾选了“GC-高铁/城际”、“D-动车”、“出发站A”、“到达站B”、“一等座”，则仅显示“G”或“C”开头的车次或“D”字头的车次，从“出发站A”出发到达“到达站B”，有“一等座”的车次）

            Scenario: 用户取消筛选条件
                Given：用户在**车次信息筛选区域** 已勾选“GC-高铁/城际”复选框，**车次列表区域**的车次信息已筛选
                When：用户再次点击并取消勾选“GC-高铁/城际”复选框
                Then：车次信息列表自动更新，移除“车次类型”的筛选限制，显示所有符合其他筛选条件的车次
            
            Scenario: 默认筛选栏初始化
                Given：用户在**车票查询页面**
                When：车次信息列表未显示
                Then：系统默认初始化“车次类型”筛选栏选项为“GC-高铁/城际”、“D-动车”
                And：“出发车站”、“到达车站”、“车次席别”筛选栏为空
            
            Scenario：自动补全筛选选项栏
                Given：用户在**车票查询页面**
                When：**车次列表区域**的车次信息已显示
                Then：系统自动补全“出发车站”的选项为**车次列表区域**所有已显示车次的出发站，“到达车站”的选项为所有**车次列表区域**已显示车次的到达站
                And 系统自动补全“车次席别”的选项为所有**车次列表区域**已显示车次的席别座位类型

        4.3.2 系统根据余票状态显示不同信息
            Scenario: 系统显示具体余票数量（少于20张）
                Given：用户在**车票查询页面**，某车次已显示在**车次列表区域**中
                When：系统从数据库中加载该车次的各种席位的余票信息
                And：该车次某种席位余票数量少于20张
                Then：该单元格直接显示剩余票数，字体为黑色

            Scenario: 系统显示“有票”（余票充足）
                Given：用户在**车票查询页面**，某车次已显示在车次信息列表中
                When：系统加载该车次的各种席位的余票信息
                And：该车次某种席位余票数量大于等于20张
                Then：该单元格显示“有”，字体为绿色

            Scenario: 系统显示“无票”（已售罄）
                Given：用户在**车票查询页面**，某车次已显示在车次信息列表中
                When：系统加载该车次的各种席位的余票信息
                And：该车次某种席位余票数量为0张
                Then：该单元格显示“无”，字体为灰色

            Scenario：系统显示“--”（该车次无该席别票）
                Given：用户在**车票查询页面**，已根据筛选条件显示了部分车次
                When：系统加载这些车次的各种席位的信息
                And：某车次没有车次列表中对应席位类别（如“GZ-高铁/城际”车次没有“硬卧”席位）
                Then：该车次在**车次列表区域**对应单元格显示“--”

            Scenario：系统更新余票状态
                Given：用户在**车票查询页面**，某车次已显示在**车次列表区域**中，且已加载该车次的各种席位的余票信息
                When：用户刷新界面
                Then：系统根据最新的余票信息，更新**车次列表区域**中对应单元格的显示内容
            
            Scenario：用户超过五分钟未刷新界面
                Given：用户在**车票查询页面**，某车次已显示在**车次列表区域**中，且已加载该车次的各种席位的余票信息
                When：用户未刷新界面，超过五分钟
                Then：系统出现弹窗提示：页面内容已过期，请重新查询！
    
    4.4 用户点击预定按钮
        4.4.1 用户在网络异常状态下尝试预定
            Scenario：用户网络异常下点击”预订“
                Given：用户在**车票查询页面**
                And：**车次列表区域**已显示
                And：用户网络异常
                When：用户点击某个可以预定的车次的”预定“按钮
                Then：系统弹出提示：网络忙，请稍后重试
                And：弹窗包含“确认”按钮，点击可以关闭弹窗并退回**车票查询页面**
        
        4.4.1 用户未登录状态下点击“预订”
            Scenario: 用户未登录时点击“预订”按钮
                Given：用户未登录
                And：用户在**车票查询页面**
                And：用户网络正常
                When：用户点击任一车次后的“预订”按钮
                Then：页面中出现弹窗提示：“请先登录！”，弹窗包含“确认”按钮允许用户点击并跳转至登录页面，若用户点击“取消”按钮，则弹窗关闭，用户继续在**车票查询页面**操作

        4.4.2 用户已登录状态下点击“预订”
            Scenario：某车次车票已售罄
                Given：用户在**车票查询页面**
                And：车次列表已显示
                When：某车次所有席别状态均显示为“无”
                Then：“预定”按钮显示为灰色，用户无法点击该按钮
            
            Scenario: 用户点击“预订”时车票恰好售罄（发生并发冲突）
                Given：用户已登录
                And：用户在**车票查询页面**
                And：用户所选车次的“预订”按钮处于可点击状态
                And：用户网络正常
                When：用户点击该车次后的“预订”按钮，但服务器端校验发现所有席别均已售罄
                Then：系统弹出提示“手慢了，该车次车票已售罄！”
                And：弹窗包含“确认”按钮允许用户点击并返回**车票查询页面**
                And：页面停留在**车票查询页面**，并刷新当前车次列表

            Scenario：用户点击“预订”时距离发车时间不足3小时
                Given：用户已登录
                And：用户在**车票查询页面**
                And：用户所选车次距离发车时间不足3小时
                And：用户网络正常
                When：用户点击该车次后的“预订”按钮
                Then：页面中央出现弹窗提示“您选择的列车距开车时间很近了，进站约需20分钟，请确保有足够的时间办理安全检查、实名制验证及检票等手续，以免耽误您的旅行。”
                And：提示弹窗包含“确认”和“取消”按钮，点击“确认”按钮关闭弹窗并在100ms之内加载购票页面，点击“取消”按钮关闭弹窗，用户继续在**车票查询页面**操作

            Scenario：用户点击有余票车次的“预订”按钮
                Given：用户已登录
                And：用户在**车票查询页面**
                And：用户所选车次有余票（席别状态显示为具体数字或“有”）
                And：用户网络正常
                When：用户点击该车次后的“预订”按钮
                Then：页面在100ms之内跳转到该车次的**购票页面**
            
            Scenario：用户点击“预定”按钮时，距离车次列表上次刷新时间超过5分钟
                Given：用户已登录
                And：用户在**车票查询页面**
                And：当前时间距离车次列表上次刷新时间超过5分钟
                When：用户点击某可以被预定的车次后的“预订”按钮
                Then：页面中央出现弹窗提示“页面内容已过期，请重新查询！”
                And：提示弹窗包含“确认”和“取消”按钮，点击“确认”按钮重新加载并刷新当前车次列表，点击“取消”按钮关闭弹窗，车次列表保持不变并且刷新时间仍然为上次的刷新时间