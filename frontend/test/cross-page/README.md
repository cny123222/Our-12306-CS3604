# 跨页流程测试文档

## 📋 测试概述

本目录包含 12306 铁路订票系统的跨页面流程测试和跨组件集成测试，确保核心业务链路的稳定性和用户体验的流畅性。

## 🎯 测试范围

### 1. 登录页 → 注册页流程测试
**文件**: `LoginToRegister.cross.spec.tsx`

**覆盖的流程**:
- ✅ 从登录页点击"注册12306账号"按钮跳转到注册页
- ✅ 从顶部导航栏的"注册"链接跳转到注册页
- ✅ 验证注册页所有必填字段标记正确显示
- ✅ 验证注册页关键UI元素正确渲染
- ✅ 验证用户协议勾选框和链接正确显示

**测试数量**: 5个测试用例

---

### 2. 注册页表单验证流程测试
**文件**: `RegisterFormValidation.cross.spec.tsx`

**覆盖的流程**:
- ✅ 完整的表单填写流程（所有必填字段）
- ✅ 用户名验证：
  - 长度验证（6-30字符）
  - 格式验证（以字母开头，只含字母数字下划线）
  - 实时反馈（绿色勾勾）
- ✅ 密码验证：
  - 长度验证（≥6字符）
  - 复杂度验证（至少包含字母、数字、下划线中的两种）
  - 实时反馈
- ✅ 确认密码验证：
  - 一致性验证
- ✅ 姓名验证：
  - 长度验证（3-30字符）
  - 格式验证（中英文、点、空格）
- ✅ 证件号码验证：
  - 长度验证（18位）
  - 格式验证（数字和字母）
- ✅ 手机号码验证：
  - 长度验证（11位）
  - 格式验证（纯数字）
- ✅ 邮箱验证（选填）：
  - 格式验证（含@和域名）
- ✅ 用户协议勾选验证

**测试数量**: 8个测试用例

---

### 3. 注册页 → 验证页流程测试
**文件**: `RegisterToVerification.cross.spec.tsx`

**覆盖的流程**:
- ✅ 完整信息填写后允许提交
- ✅ 信息不完整时阻止提交
- ✅ 字段验证失败时阻止提交
- ✅ 密码强度指示器交互
- ✅ 证件类型选择交互
- ✅ 优惠类型选择交互
- ✅ 导航路径提示显示

**测试数量**: 7个测试用例

---

## 📊 测试统计

| 测试文件 | 测试用例数 | 状态 |
|---------|----------|------|
| LoginToRegister.cross.spec.tsx | 5 | ✅ 已创建 |
| RegisterFormValidation.cross.spec.tsx | 8 | ✅ 已创建 |
| RegisterToVerification.cross.spec.tsx | 7 | ✅ 已创建 |
| **总计** | **20** | **✅ 已创建** |

---

## 🔄 测试流程图

```
┌─────────────┐
│   登录页     │
│  LoginPage  │
└──────┬──────┘
       │ 点击"注册12306账号"
       │ 或顶部"注册"链接
       ↓
┌─────────────┐
│   注册页     │
│ RegisterPage│
└──────┬──────┘
       │ 1. 填写用户名 (验证: 6-30位, 字母开头, 字母数字下划线)
       │ 2. 填写登录密码 (验证: ≥6位, 两种以上字符类型)
       │ 3. 填写确认密码 (验证: 与密码一致)
       │ 4. 选择证件类型 (8种类型)
       │ 5. 填写姓名 (验证: 3-30字符, 中英文)
       │ 6. 填写证件号码 (验证: 18位, 数字字母)
       │ 7. 选择优惠类型 (4种类型)
       │ 8. 填写邮箱 (选填, 验证: 邮箱格式)
       │ 9. 填写手机号 (验证: 11位纯数字)
       │ 10. 勾选用户协议
       │ 11. 点击"下一步"
       ↓
┌─────────────┐
│   验证页     │
│Verification │  (待实现)
└──────┬──────┘
       │ 输入短信验证码
       │ 输入邮箱验证码(如有)
       │ 点击"立即注册"
       ↓
┌─────────────┐
│ 注册成功弹窗 │
└──────┬──────┘
       │ 点击"确认"
       ↓
┌─────────────┐
│   登录页     │
│  LoginPage  │
└─────────────┘
```

---

## 🧪 运行测试

### 运行所有跨页测试
```bash
npm test -- test/cross-page
```

### 运行特定测试文件
```bash
# 登录页到注册页测试
npm test -- test/cross-page/LoginToRegister.cross.spec.tsx

# 注册表单验证测试
npm test -- test/cross-page/RegisterFormValidation.cross.spec.tsx

# 注册页到验证页测试
npm test -- test/cross-page/RegisterToVerification.cross.spec.tsx
```

### 运行并查看详细报告
```bash
npm test -- test/cross-page --reporter=verbose
```

### 运行并生成覆盖率报告
```bash
npm test -- test/cross-page --coverage
```

---

## ✅ 测试检查清单

### 注册页面跨页流程测试

- [x] **导航测试**
  - [x] 从登录页通过"注册12306账号"按钮导航到注册页
  - [x] 从顶部导航栏的"注册"链接导航到注册页
  - [x] 验证注册页正确渲染

- [x] **表单字段验证**
  - [x] 用户名字段验证（长度、格式、唯一性）
  - [x] 密码字段验证（长度、复杂度）
  - [x] 确认密码验证（一致性）
  - [x] 姓名字段验证（长度、格式）
  - [x] 证件号码验证（长度、格式）
  - [x] 手机号码验证（长度、格式）
  - [x] 邮箱验证（选填、格式）

- [x] **UI交互测试**
  - [x] 证件类型下拉选择
  - [x] 优惠类型下拉选择
  - [x] 密码强度指示器
  - [x] 用户协议勾选框
  - [x] 实时验证反馈（绿色勾勾）

- [x] **表单提交测试**
  - [x] 信息完整时允许提交
  - [x] 信息不完整时阻止提交
  - [x] 验证失败时阻止提交
  - [x] 未勾选协议时阻止提交

---

## 📝 测试用例详细说明

### 用户名验证规则
- **长度**: 6-30个字符
- **开头**: 必须以字母开头
- **字符**: 只能包含字母、数字和下划线
- **错误提示**:
  - 长度不足: "用户名长度不能少于6个字符！"
  - 长度超出: "用户名长度不能超过30个字符！"
  - 格式错误: "用户名只能由字母、数字和_组成，须以字母开头！"
  - 已被占用: "该用户名已经占用，请重新选择用户名！"

### 密码验证规则
- **长度**: 至少6个字符
- **复杂度**: 必须包含字母、数字、下划线中的至少两种
- **错误提示**:
  - 长度不足: "密码长度不能少于6个字符！"
  - 复杂度不足: "格式错误，必须且只能包含字母、数字和下划线中的两种或两种以上！"

### 手机号验证规则
- **长度**: 11位
- **格式**: 纯数字
- **错误提示**:
  - 长度不足: "您输入的手机号码不是有效的格式！"
  - 格式错误: "您输入的手机号码不是有效的格式！"

### 邮箱验证规则（选填）
- **格式**: 必须包含@符号和域名
- **错误提示**:
  - 格式错误: "请输入有效的电子邮件地址！"

---

## 🔍 测试覆盖的业务场景

### 成功路径
1. ✅ 用户从登录页导航到注册页
2. ✅ 用户按顺序填写所有必填字段
3. ✅ 每个字段通过实时验证显示绿色勾勾
4. ✅ 用户勾选用户协议
5. ✅ 用户点击"下一步"进入验证页（待实现）

### 异常路径
1. ✅ 用户名不符合规范 → 显示相应错误提示
2. ✅ 密码不符合规范 → 显示相应错误提示
3. ✅ 确认密码不一致 → 显示错误提示
4. ✅ 必填字段未填写 → 显示"请填写完整信息！"
5. ✅ 未勾选协议 → 显示"请确认服务条款！"

### 边界场景
1. ✅ 用户名恰好6个字符 → 应该通过验证
2. ✅ 用户名恰好30个字符 → 应该通过验证
3. ✅ 手机号输入超过11位 → 只保留前11位
4. ✅ 邮箱为空 → 不显示错误（选填字段）

---

## 🚀 未来测试计划

### 待实现的测试
- [ ] 验证页面跨页流程测试（等待验证页实现）
- [ ] 注册成功后跳转登录页测试
- [ ] 服务条款页面跳转测试
- [ ] 隐私权政策页面跳转测试
- [ ] 首页到注册页的跨页测试（等待首页实现）

### 待增强的测试
- [ ] 并发注册场景测试
- [ ] 网络错误处理测试
- [ ] 表单数据持久化测试（页面刷新后）
- [ ] 无障碍访问测试
- [ ] 移动端响应式测试

---

## 📖 相关文档

- [注册页需求文档](../../requirements/02-登录注册页/02-2-注册页.md)
- [跳转信息文档](../../requirements/02-登录注册页/跳转信息.md)
- [UI接口规范](.artifacts/ui_interface.yml)

---

## 🤝 贡献指南

### 添加新测试
1. 在 `frontend/test/cross-page/` 目录下创建新的测试文件
2. 文件命名格式: `<Feature>.cross.spec.tsx`
3. 在文件顶部添加清晰的测试场景说明
4. 更新本 README 文档
5. 确保所有测试通过

### 测试命名规范
- 使用中文描述测试场景（更清晰地对应需求文档）
- 使用 `describe` 组织测试套件
- 使用 `it` 描述具体测试用例
- 每个测试用例应该只测试一个功能点

---

## ⚠️ 注意事项

1. **测试隔离**: 每个测试用例应该独立运行，不依赖其他测试的状态
2. **异步处理**: 使用 `waitFor` 处理异步操作和DOM更新
3. **用户交互**: 使用 `userEvent` 而非 `fireEvent` 模拟真实用户行为
4. **清理工作**: 在 `beforeEach` 中清理状态，避免测试间相互影响
5. **Mock策略**: 合理使用 Mock 避免依赖外部服务，但保持测试真实性

---

**最后更新**: 2025-11-11  
**维护者**: 跨页流程测试工程师  
**测试框架**: Vitest + React Testing Library  
**当前状态**: ✅ 20个测试用例已创建，待运行验证

