# æ•°æ®åº“é›†æˆåŠŸèƒ½æ£€æŸ¥æ¸…å•

**æ£€æŸ¥æ—¥æœŸ**: 2025-11-12  
**ç›®çš„**: ç¡®ä¿æ‰€æœ‰éœ€è¦ä»æ•°æ®åº“æ£€ç´¢æ•°æ®çš„åŠŸèƒ½éƒ½å·²æ­£ç¡®å®ç°

---

## âœ… å·²ä¿®å¤çš„é—®é¢˜

### 1. ç«™ç‚¹æœç´¢åŠŸèƒ½ (**å·²ä¿®å¤**)
**é—®é¢˜**: StationInputç»„ä»¶æ²¡æœ‰è°ƒç”¨APIï¼Œå¯¼è‡´ç‚¹å‡»è¾“å…¥æ¡†æ—¶æ˜¾ç¤º"æš‚æ— åŒ¹é…ç«™ç‚¹"

**ä¿®å¤å†…å®¹**:
- âœ… ä¿®æ”¹ `frontend/src/components/StationInput.tsx`ï¼Œæ·»åŠ çœŸå®çš„APIè°ƒç”¨
- âœ… åœ¨ `handleFocus` ä¸­è°ƒç”¨ `getAllStations()` è·å–æ‰€æœ‰ç«™ç‚¹
- âœ… åœ¨ `handleChange` ä¸­è°ƒç”¨ `searchStations()` å®æ—¶æœç´¢
- âœ… æ”¹è¿› `backend/database/init-trains-data.js` æ·»åŠ æ‹¼éŸ³ç”Ÿæˆ
- âœ… é‡æ–°åˆå§‹åŒ–æ•°æ®åº“ï¼Œç«™ç‚¹æ•°æ®åŒ…å«æ­£ç¡®çš„æ‹¼éŸ³å’Œç®€æ‹¼

---

## ğŸ“‹ éœ€æ±‚æ–‡æ¡£ä¸­éœ€è¦æ•°æ®åº“æ£€ç´¢çš„åŠŸèƒ½

### é¦–é¡µæŸ¥è¯¢é¡µ (01-é¦–é¡µæŸ¥è¯¢é¡µ.md)

| éœ€æ±‚ç« èŠ‚ | åŠŸèƒ½æè¿° | å®ç°çŠ¶æ€ | å¤‡æ³¨ |
|---------|---------|---------|------|
| 1.2.5 | åˆæ³•å‡ºå‘åœ°æ¨èï¼šç‚¹å‡»å‡ºå‘åœ°è¾“å…¥æ¡†ï¼Œæ˜¾ç¤ºæ•°æ®åº“ä¸­çš„æ‰€æœ‰ç«™ç‚¹ | âœ… å·²å®ç° | StationInput + getAllStations() |
| 1.2.6 | åˆæ³•åˆ°è¾¾åœ°æ¨èï¼šç‚¹å‡»åˆ°è¾¾åœ°è¾“å…¥æ¡†ï¼Œæ˜¾ç¤ºæ•°æ®åº“ä¸­çš„æ‰€æœ‰ç«™ç‚¹ | âœ… å·²å®ç° | StationInput + getAllStations() |
| 1.2.3 | æ ¡éªŒå‡ºå‘åœ°æ˜¯å¦åˆæ³•ï¼šä¸åœ¨æ•°æ®åº“ä¸­æ—¶æ¨èç›¸ä¼¼ç«™ç‚¹ | âœ… å·²å®ç° | validateStation() |
| 1.2.4 | æ ¡éªŒåˆ°è¾¾åœ°æ˜¯å¦åˆæ³•ï¼šä¸åœ¨æ•°æ®åº“ä¸­æ—¶æ¨èç›¸ä¼¼ç«™ç‚¹ | âœ… å·²å®ç° | validateStation() |
| 1.2.10 | ç”¨æˆ·æˆåŠŸæŸ¥è¯¢ï¼šè·³è½¬åˆ°è½¦æ¬¡åˆ—è¡¨é¡µå¹¶æ˜¾ç¤ºè½¦æ¬¡ä¿¡æ¯ | âš ï¸ éƒ¨åˆ†å®ç° | å¯¼èˆªå·²å®ç°ï¼Œéœ€è¦è½¦æ¬¡æŸ¥è¯¢API |

### è½¦æ¬¡åˆ—è¡¨é¡µ (03-è½¦æ¬¡åˆ—è¡¨é¡µ.md)

| éœ€æ±‚ç« èŠ‚ | åŠŸèƒ½æè¿° | å®ç°çŠ¶æ€ | å¤‡æ³¨ |
|---------|---------|---------|------|
| 4.3.5 | åˆæ³•å‡ºå‘åœ°æ¨èï¼šæ˜¾ç¤ºæ•°æ®åº“å­˜å‚¨çš„æ‰€æœ‰ç«™ç‚¹ | âœ… å·²å®ç° | StationInput + getAllStations() |
| 4.3.6 | åˆæ³•åˆ°è¾¾åœ°æ¨èï¼šæ˜¾ç¤ºæ•°æ®åº“å­˜å‚¨çš„æ‰€æœ‰ç«™ç‚¹ | âœ… å·²å®ç° | StationInput + getAllStations() |
| 4.3.3 | æ ¡éªŒå‡ºå‘åœ°æ˜¯å¦åˆæ³•ï¼šæ¨èç›¸ä¼¼ç«™ç‚¹ | âœ… å·²å®ç° | validateStation() |
| 4.3.4 | æ ¡éªŒåˆ°è¾¾åœ°æ˜¯å¦åˆæ³•ï¼šæ¨èç›¸ä¼¼ç«™ç‚¹ | âœ… å·²å®ç° | validateStation() |
| 4.3.8 | ç”¨æˆ·æˆåŠŸæŸ¥è¯¢ï¼šæ˜¾ç¤ºç¬¦åˆæ¡ä»¶çš„è½¦æ¬¡åˆ—è¡¨ | âš ï¸ å¾…å®ç° | éœ€è¦searchTrains() API |
| 4.4.2 | ä½™ç¥¨æ•°è®¡ç®—ï¼šä»æ•°æ®åº“æŸ¥è¯¢åº§ä½çŠ¶æ€ | âš ï¸ å¾…å®ç° | éœ€è¦å®ç°ä½™ç¥¨è®¡ç®—é€»è¾‘ |
| 4.4.3 | ç¥¨ä»·è®¡ç®—ï¼šä»æ•°æ®åº“æŸ¥è¯¢ç¥¨ä»·ä¿¡æ¯ | âš ï¸ å¾…å®ç° | éœ€è¦å®ç°ç¥¨ä»·è®¡ç®—API |
| 4.5.1 | ç­›é€‰è½¦æ¬¡ä¿¡æ¯ï¼šæ ¹æ®è½¦æ¬¡ç±»å‹ã€å‡ºå‘ç«™ã€åˆ°è¾¾ç«™ã€å¸­åˆ«ç­›é€‰ | âš ï¸ å¾…å®ç° | å‰ç«¯ç­›é€‰é€»è¾‘ |
| 4.3.2 | æ˜¾ç¤ºä½™ç¥¨çŠ¶æ€ï¼šæœ‰ç¥¨/æ— ç¥¨/å…·ä½“æ•°é‡/-- | âš ï¸ å¾…å®ç° | éœ€è¦ä½™ç¥¨æŸ¥è¯¢API |

---

## ğŸ” è¯¦ç»†æ£€æŸ¥ç»“æœ

### âœ… å·²å®Œå…¨å®ç°çš„åŠŸèƒ½

#### 1. ç«™ç‚¹åˆ—è¡¨è·å–
**åç«¯å®ç°**: 
- `GET /api/stations` - è·å–æ‰€æœ‰ç«™ç‚¹
- `backend/src/services/stationService.js` - getAllStations()

**å‰ç«¯å®ç°**:
- `frontend/src/services/stationService.ts` - getAllStations()
- `frontend/src/components/StationInput.tsx` - è°ƒç”¨API

**æµ‹è¯•**:
```bash
# æµ‹è¯•åç«¯API
curl http://localhost:3000/api/stations

# éªŒè¯æ•°æ®åº“
sqlite3 backend/database/railway.db "SELECT COUNT(*) FROM stations;"
# ç»“æœ: 16ä¸ªç«™ç‚¹
```

#### 2. ç«™ç‚¹æœç´¢ï¼ˆæ”¯æŒç®€æ‹¼/å…¨æ‹¼/æ±‰å­—ï¼‰
**åç«¯å®ç°**:
- `GET /api/stations?keyword=xxx` - æœç´¢ç«™ç‚¹
- `backend/src/services/stationService.js` - searchStations()

**å‰ç«¯å®ç°**:
- `frontend/src/services/stationService.ts` - searchStations()
- `frontend/src/components/StationInput.tsx` - å®æ—¶æœç´¢

**æ•°æ®åº“æ”¯æŒ**:
- stationsè¡¨åŒ…å«: name, pinyin, short_pinyin
- æ”¯æŒ LIKE æŸ¥è¯¢åŒ¹é…

#### 3. ç«™ç‚¹éªŒè¯ä¸æ¨è
**åç«¯å®ç°**:
- `POST /api/stations/validate` - éªŒè¯ç«™ç‚¹å¹¶æ¨èç›¸ä¼¼ç«™ç‚¹
- `backend/src/services/stationService.js` - validateStation()

**å‰ç«¯å®ç°**:
- `frontend/src/services/stationService.ts` - validateStation()
- `frontend/src/components/TrainSearchForm.tsx` - è°ƒç”¨éªŒè¯

---

### âš ï¸ éƒ¨åˆ†å®ç°/å¾…å®ç°çš„åŠŸèƒ½

#### 1. è½¦æ¬¡æŸ¥è¯¢ (å¾…å®ç°)
**éœ€æ±‚**: æ ¹æ®å‡ºå‘åœ°ã€åˆ°è¾¾åœ°ã€å‡ºå‘æ—¥æœŸæŸ¥è¯¢è½¦æ¬¡

**å½“å‰çŠ¶æ€**:
- âŒ åç«¯APIæœªå®ç°: `POST /api/trains/search`
- âŒ åç«¯æœåŠ¡æœªå®ç°: trainService.searchTrains()
- âš ï¸ æ•°æ®åº“è¡¨å·²åˆ›å»º: trains, train_stops

**éœ€è¦å®ç°**:
```javascript
// backend/src/services/trainService.js
async function searchTrains(departureStation, arrivalStation, departureDate) {
  // 1. æŸ¥è¯¢åŒ…å«è¿™ä¸¤ä¸ªç«™ç‚¹çš„è½¦æ¬¡
  // 2. æ£€æŸ¥ç«™ç‚¹é¡ºåºï¼ˆå‡ºå‘ç«™åœ¨åˆ°è¾¾ç«™ä¹‹å‰ï¼‰
  // 3. è¿”å›è½¦æ¬¡åˆ—è¡¨withåœé æ—¶é—´
}
```

#### 2. ä½™ç¥¨æŸ¥è¯¢ (å¾…å®ç°)
**éœ€æ±‚**: è®¡ç®—æŒ‡å®šè½¦æ¬¡ã€å¸­åˆ«ã€åŒºé—´çš„ä½™ç¥¨æ•°

**å½“å‰çŠ¶æ€**:
- âœ… æ•°æ®åº“è¡¨å·²åˆ›å»º: seat_status
- âœ… åº§ä½çŠ¶æ€å·²åˆå§‹åŒ–: 26320æ¡è®°å½•
- âŒ ä½™ç¥¨è®¡ç®—APIæœªå®ç°

**éœ€æ±‚æ–‡æ¡£4.4.2è§„å®š**:
- ç›¸é‚»ä¸¤ç«™ï¼šç›´æ¥ç»Ÿè®¡ available çŠ¶æ€çš„åº§ä½æ•°
- éç›¸é‚»ä¸¤ç«™ï¼šåªæœ‰åº§ä½åœ¨æ‰€æœ‰åŒºé—´éƒ½æ˜¯ available æ‰è®¡å…¥
- å”®ç½„æƒ…å†µï¼šä»»ä¸€ä¸­é—´åŒºé—´è¢«é¢„è®¢åˆ™ä½™ç¥¨ä¸º0

**éœ€è¦å®ç°**:
```javascript
// backend/src/services/ticketService.js
async function getAvailableSeats(trainNo, fromStation, toStation, seatType) {
  // 1. è·å–è½¦æ¬¡çš„æ‰€æœ‰åœé ç«™
  // 2. ç¡®å®šfromStationåˆ°toStationç»è¿‡çš„æ‰€æœ‰åŒºé—´
  // 3. æŸ¥è¯¢æ¯ä¸ªåº§ä½åœ¨è¿™äº›åŒºé—´çš„çŠ¶æ€
  // 4. åªè®¡ç®—åœ¨æ‰€æœ‰åŒºé—´éƒ½æ˜¯availableçš„åº§ä½
}
```

#### 3. ç¥¨ä»·è®¡ç®— (å¾…å®ç°)
**éœ€æ±‚**: è®¡ç®—æŒ‡å®šåŒºé—´çš„ç¥¨ä»·

**å½“å‰çŠ¶æ€**:
- âœ… æ•°æ®åº“è¡¨å·²åˆ›å»º: train_fares
- âœ… ç¥¨ä»·æ•°æ®å·²æ’å…¥: 24æ¡è®°å½•
- âŒ ç¥¨ä»·è®¡ç®—APIæœªå®ç°

**éœ€æ±‚æ–‡æ¡£4.4.3è§„å®š**:
- æŸä¸¤ç«™ä¹‹é—´æŸå¸­ä½ç¥¨ä»· = é€”ç»ç«™ç‚¹ä¹‹é—´è¯¥å¸­ä½ç¥¨ä»·ä¹‹å’Œ

**éœ€è¦å®ç°**:
```javascript
// backend/src/services/ticketService.js
async function calculateFare(trainNo, fromStation, toStation, seatType) {
  // 1. è·å–é€”ç»çš„æ‰€æœ‰åŒºé—´
  // 2. ç´¯åŠ å„åŒºé—´çš„ç¥¨ä»·
  // 3. è¿”å›æ€»ç¥¨ä»·
}
```

#### 4. è½¦æ¬¡ç­›é€‰ (å¾…å®ç°)
**éœ€æ±‚**: æ ¹æ®è½¦æ¬¡ç±»å‹ã€å‡ºå‘ç«™ã€åˆ°è¾¾ç«™ã€å¸­åˆ«ç­›é€‰

**å½“å‰çŠ¶æ€**:
- âš ï¸ å‰ç«¯ç»„ä»¶å·²åˆ›å»º: TrainFilterPanel.tsx
- âŒ ç­›é€‰é€»è¾‘æœªå®ç°

**éœ€è¦å®ç°**:
- å‰ç«¯ï¼šTrainFilterPanelç»„ä»¶çš„ç­›é€‰é€»è¾‘
- æˆ–è€…ï¼šåç«¯APIæ”¯æŒç­›é€‰å‚æ•°

---

## ğŸ§ª æµ‹è¯•å»ºè®®

### 1. ç«™ç‚¹æœç´¢åŠŸèƒ½æµ‹è¯•
```bash
# å¯åŠ¨åç«¯æœåŠ¡
cd backend && npm start

# æµ‹è¯•1: è·å–æ‰€æœ‰ç«™ç‚¹
curl http://localhost:3000/api/stations

# æµ‹è¯•2: æœç´¢ç«™ç‚¹ï¼ˆæ±‰å­—ï¼‰
curl "http://localhost:3000/api/stations?keyword=åŒ—äº¬"

# æµ‹è¯•3: æœç´¢ç«™ç‚¹ï¼ˆå…¨æ‹¼ï¼‰
curl "http://localhost:3000/api/stations?keyword=beijing"

# æµ‹è¯•4: æœç´¢ç«™ç‚¹ï¼ˆç®€æ‹¼ï¼‰
curl "http://localhost:3000/api/stations?keyword=bj"

# æµ‹è¯•5: éªŒè¯ç«™ç‚¹
curl -X POST http://localhost:3000/api/stations/validate \
  -H "Content-Type: application/json" \
  -d '{"stationName": "åŒ—äº¬å—"}'
```

### 2. å‰ç«¯ç»„ä»¶æµ‹è¯•
```bash
# å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨
cd frontend && npm run dev

# æ‰‹åŠ¨æµ‹è¯•:
# 1. æ‰“å¼€é¦–é¡µ
# 2. ç‚¹å‡»"å‡ºå‘åœ°"è¾“å…¥æ¡†
# 3. åº”è¯¥æ˜¾ç¤ºæ‰€æœ‰16ä¸ªç«™ç‚¹
# 4. è¾“å…¥"bei"æˆ–"åŒ—"
# 5. åº”è¯¥æ˜¾ç¤ºåŒ—äº¬ã€åŒ—äº¬å—ç­‰åŒ¹é…ç«™ç‚¹
# 6. é€‰æ‹©ä¸€ä¸ªç«™ç‚¹
# 7. éªŒè¯ç«™ç‚¹åç§°å¡«å……åˆ°è¾“å…¥æ¡†
```

### 3. æ•°æ®åº“å®Œæ•´æ€§æ£€æŸ¥
```bash
cd backend

# æ£€æŸ¥ç«™ç‚¹æ•°æ®
sqlite3 database/railway.db "SELECT COUNT(*) FROM stations;"
# é¢„æœŸ: 16

# æ£€æŸ¥æ‹¼éŸ³æ•°æ®
sqlite3 database/railway.db "SELECT name, pinyin, short_pinyin FROM stations WHERE name='åŒ—äº¬å—';"
# é¢„æœŸ: åŒ—äº¬å—|beijingnan|bjn

# æ£€æŸ¥è½¦æ¬¡æ•°æ®
sqlite3 database/railway.db "SELECT COUNT(*) FROM trains;"
# é¢„æœŸ: 4 (G103, G16, D6, D9)

# æ£€æŸ¥åº§ä½çŠ¶æ€æ•°æ®
sqlite3 database/railway.db "SELECT COUNT(*) FROM seat_status;"
# é¢„æœŸ: 26320

# æ£€æŸ¥ç¥¨ä»·æ•°æ®
sqlite3 database/railway.db "SELECT COUNT(*) FROM train_fares;"
# é¢„æœŸ: 24
```

---

## ğŸ“ æ€»ç»“

### âœ… å·²å®Œæˆ
1. ä¿®å¤äº†StationInputç»„ä»¶ï¼Œç°åœ¨å¯ä»¥æ­£ç¡®è°ƒç”¨API
2. æ”¹è¿›äº†æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬ï¼Œæ·»åŠ æ‹¼éŸ³æ”¯æŒ
3. ç«™ç‚¹åˆ—è¡¨è·å–åŠŸèƒ½å®Œæ•´å®ç°
4. ç«™ç‚¹æœç´¢åŠŸèƒ½å®Œæ•´å®ç°ï¼ˆæ”¯æŒç®€æ‹¼/å…¨æ‹¼/æ±‰å­—ï¼‰
5. ç«™ç‚¹éªŒè¯ä¸æ¨èåŠŸèƒ½å®Œæ•´å®ç°

### âš ï¸ å¾…å®ç°
1. **è½¦æ¬¡æŸ¥è¯¢API** - æ ¹æ®å‡ºå‘åœ°ã€åˆ°è¾¾åœ°ã€æ—¥æœŸæŸ¥è¯¢è½¦æ¬¡
2. **ä½™ç¥¨è®¡ç®—API** - æŒ‰ç…§éœ€æ±‚4.4.2çš„è§„åˆ™è®¡ç®—ä½™ç¥¨
3. **ç¥¨ä»·è®¡ç®—API** - æŒ‰ç…§éœ€æ±‚4.4.3çš„è§„åˆ™è®¡ç®—ç¥¨ä»·
4. **è½¦æ¬¡ç­›é€‰é€»è¾‘** - å‰ç«¯ç­›é€‰åŠŸèƒ½
5. **ä½™ç¥¨çŠ¶æ€æ˜¾ç¤º** - æœ‰/æ— /å…·ä½“æ•°å­—/--çš„æ˜¾ç¤ºé€»è¾‘

### ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨
1. å®ç° `backend/src/services/trainService.js` - è½¦æ¬¡æŸ¥è¯¢æœåŠ¡
2. å®ç° `backend/src/services/ticketService.js` - ä½™ç¥¨å’Œç¥¨ä»·è®¡ç®—
3. åˆ›å»º `backend/src/routes/trains.js` - è½¦æ¬¡æŸ¥è¯¢APIè·¯ç”±
4. æµ‹è¯•æ‰€æœ‰æ•°æ®åº“æ£€ç´¢åŠŸèƒ½
5. ç¼–å†™é›†æˆæµ‹è¯•éªŒè¯æ•°æ®å®Œæ•´æ€§

---

**ç»´æŠ¤è€…**: æ•°æ®åº“é›†æˆå·¥ç¨‹å¸ˆ  
**æœ€åæ›´æ–°**: 2025-11-12

