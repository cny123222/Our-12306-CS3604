# 城市级车次搜索功能测试指南

## 测试前准备

### 1. 启动后端服务
```bash
cd backend
npm run dev
```
后端应该运行在 http://localhost:3000

### 2. 启动前端服务
```bash
cd frontend
npm run dev
```
前端应该运行在 http://localhost:5173

## 测试步骤

### 测试1: 首页城市搜索

1. 打开浏览器，访问 http://localhost:5173
2. 找到首页的搜索表单
3. 点击"出发城市"输入框
4. **验证**：下拉列表应该只显示"上海"和"北京"（不再显示车站名）
5. 选择"上海"作为出发城市
6. 点击"到达城市"输入框
7. **验证**：下拉列表应该只显示"上海"和"北京"
8. 选择"北京"作为到达城市
9. 选择出发日期（今天或未来日期）
10. 点击"查询"按钮
11. **验证**：应该跳转到车次列表页，显示从上海到北京的所有车次

### 测试2: 车次列表显示准确车站名

在车次列表页上：
1. **验证**：每个车次应该显示准确的车站名，例如：
   - 出发站：上海虹桥、上海、上海松江、上海南（其中之一）
   - 到达站：北京南、北京丰台、北京（其中之一）
2. **验证**：车次数量应该比之前只搜索单个车站时多

### 测试3: 筛选面板显示城市所有车站

在车次列表页上：
1. 查看"出发车站"筛选行
2. **验证**：应该显示上海的所有4个车站：
   - 上海虹桥
   - 上海
   - 上海松江
   - 上海南
3. 查看"到达车站"筛选行
4. **验证**：应该显示北京的所有3个车站：
   - 北京南
   - 北京丰台
   - 北京

### 测试4: 车站筛选功能

1. 勾选"出发车站"中的"上海虹桥"
2. **验证**：车次列表应该立即刷新，只显示从上海虹桥出发的车次
3. 再勾选"上海"
4. **验证**：车次列表应该显示从上海虹桥或上海出发的车次（并集）
5. 取消勾选所有出发车站
6. **验证**：车次列表恢复显示所有车次
7. 勾选"到达车站"中的"北京南"
8. **验证**：车次列表只显示到达北京南的车次

### 测试5: 车次列表页搜索栏

1. 在车次列表页，点击搜索栏中的"出发城市"输入框
2. **验证**：下拉列表只显示"上海"和"北京"
3. 更改出发城市为"北京"
4. 更改到达城市为"上海"
5. 点击"查询"按钮
6. **验证**：
   - 车次列表更新为北京到上海的车次
   - 出发车站筛选显示北京的所有车站
   - 到达车站筛选显示上海的所有车站

### 测试6: 错误处理

1. 打开浏览器控制台（F12）
2. 在首页搜索表单中手动输入一个不存在的城市（通过控制台或直接编辑）
3. **验证**：应该显示"无法匹配该出发城市"或类似错误信息
4. 不输入任何城市直接点击"查询"
5. **验证**：应该显示"请选择出发城市"错误提示

### 测试7: 交换城市功能

1. 在首页，选择出发城市"上海"，到达城市"北京"
2. 点击中间的交换按钮（双箭头图标）
3. **验证**：出发城市变为"北京"，到达城市变为"上海"

## API测试（可选）

### 测试城市列表API
```bash
curl http://localhost:3000/api/trains/cities
```
**期望输出**：
```json
{
  "cities": ["上海", "北京"]
}
```

### 测试城市车站列表API
```bash
curl http://localhost:3000/api/trains/cities/上海/stations
```
**期望输出**：
```json
{
  "city": "上海",
  "stations": ["上海虹桥", "上海", "上海松江", "上海南"]
}
```

### 测试车次搜索API
```bash
curl -X POST http://localhost:3000/api/trains/search \
  -H "Content-Type: application/json" \
  -d '{
    "departureStation": "上海",
    "arrivalStation": "北京",
    "departureDate": "2025-01-25",
    "trainTypes": []
  }'
```
**期望输出**：包含多个车次的JSON，每个车次的departureStation和arrivalStation是具体的车站名。

## 预期结果总结

✅ **正确行为**：
- 搜索框只显示城市选项（上海、北京）
- 车次列表显示准确的车站名
- 筛选面板显示城市的所有车站
- 勾选车站后立即筛选车次
- 错误提示清晰准确

❌ **错误行为**：
- 搜索框显示车站名
- 车次列表显示城市名而非车站名
- 筛选面板只显示有车次的车站
- 勾选车站后无反应

## 故障排查

### 问题1: 搜索框仍然显示车站名
- **原因**：前端代码可能没有更新
- **解决**：重启前端服务，清除浏览器缓存

### 问题2: 后端返回错误"无法匹配该城市"
- **原因**：城市配置未加载
- **检查**：查看 `backend/src/config/cityStationMapping.js` 是否存在
- **解决**：重启后端服务

### 问题3: 筛选面板为空
- **原因**：API调用失败
- **检查**：浏览器控制台查看网络请求
- **解决**：确认后端服务正常运行

### 问题4: 车次列表为空但应该有结果
- **原因**：数据库中可能没有相应城市的车站数据
- **检查**：数据库中车站名是否与配置文件中的车站名完全匹配
- **解决**：检查并更新数据库或配置文件

## 测试完成检查清单

- [ ] 首页搜索框显示城市选项
- [ ] 车次列表页搜索框显示城市选项
- [ ] 车次列表显示准确的车站名
- [ ] 筛选面板显示上海的4个车站
- [ ] 筛选面板显示北京的3个车站
- [ ] 勾选车站后车次列表正确筛选
- [ ] 交换城市功能正常
- [ ] 错误提示正确显示
- [ ] API测试全部通过

## 报告问题

如果发现问题，请记录：
1. 重现步骤
2. 期望行为
3. 实际行为
4. 浏览器控制台错误信息
5. 后端日志错误信息

